
<!DOCTYPE html>
<html>
<head>
    <title>Intersection Hazard Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <style>
        html, body, #map { height: 100%; margin: 0; padding: 0; }
        .legend, .checkboxes {
            background: white;
            padding: 10px;
            border: 1px solid gray;
            font-size: 14px;
            line-height: 1.5em;
        }
        .legend i {
            width: 12px;
            height: 12px;
            float: left;
            margin-right: 6px;
            opacity: 0.7;
        }
        .leaflet-top.leaflet-left { margin-top: 60px; }
    </style>
</head>
<body>
<div id="map"></div>

<div id="checkbox-container" class="leaflet-top leaflet-left checkboxes" style="position: absolute; top: 10px; left: 10px; z-index: 1000;">
    <strong>Toggle Hazard Levels:</strong><br>
    <label><input type="checkbox" id="Safe" checked> Safe</label><br>
    <label><input type="checkbox" id="Acceptable" checked> Acceptable</label><br>
    <label><input type="checkbox" id="Somewhat hazardous" checked> Somewhat hazardous</label><br>
    <label><input type="checkbox" id="Hazardous" checked> Hazardous</label><br>
    <label><input type="checkbox" id="Very Hazardous" checked> Very Hazardous</label><br>
</div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
var map = L.map('map').setView([45.52, -73.6], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

var hazardColors = {
    'Safe': 'blue',
    'Acceptable': 'lightblue',
    'Somewhat hazardous': 'orange',
    'Hazardous': 'red',
    'Very Hazardous': 'darkred'
};

var groups = {
    'Safe': L.layerGroup(),
    'Acceptable': L.layerGroup(),
    'Somewhat hazardous': L.layerGroup(),
    'Hazardous': L.layerGroup(),
    'Very Hazardous': L.layerGroup()
};

fetch('https://abdollahishabnam.github.io/Intersection-model/intersection_model_all_levels.geojson')
    .then(res => res.json())
    .then(data => {
        var bounds = [];

        data.features.forEach(f => {
            var p = f.properties;
            var level = p["Hazard lev"];
            var coords = f.geometry.coordinates;

            if (level && groups[level]) {
                var popup = `
                    <b>Node Number:</b> ${p["NODENUM"]}<br>
                    <b>Intersection design:</b> ${p["Intersecti"]}<br>
                    <b>Traffic calming:</b> ${p["Traffic ca"]}<br>
                    <b>Land use:</b> ${p["Land use"]}<br>
                    <b>Traffic control:</b> ${p["Traffic co"]}<br>
                    <b>Visibility:</b> ${p["Visibility"]}<br>
                    <b>Bike path design:</b> ${p["Bike path"]}<br>
                    <b>Segment danger level:</b> ${p["Segment da"]}<br>
                    <b>Hazard level:</b> ${p["Hazard lev"]}
                `;

                var marker = L.circleMarker([coords[1], coords[0]], {
                    radius: 5,
                    fillColor: hazardColors[level],
                    color: hazardColors[level],
                    weight: 1,
                    fillOpacity: 0.8
                }).bindPopup(popup);

                marker.addTo(groups[level]);
                bounds.push([coords[1], coords[0]]);
            }
        });

        // Add visible groups to map
        for (const key in groups) {
            groups[key].addTo(map);
        }

        if (bounds.length > 0) {
            map.fitBounds(bounds);
        }

        // Link checkboxes to toggle layer visibility
        for (const key in groups) {
            document.getElementById(key).addEventListener('change', function(e) {
                if (e.target.checked) {
                    groups[e.target.id].addTo(map);
                } else {
                    map.removeLayer(groups[e.target.id]);
                }
            });
        }
    });

// Legend
var legend = L.control({position: 'bottomright'});
legend.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'legend');
    var levels = ['Safe', 'Acceptable', 'Somewhat hazardous', 'Hazardous', 'Very Hazardous'];
    var colors = ['blue', 'lightblue', 'orange', 'red', 'darkred'];
    for (var i = 0; i < levels.length; i++) {
        div.innerHTML += '<i style="background:' + colors[i] + '"></i> ' + levels[i] + '<br>';
    }
    return div;
};
legend.addTo(map);
</script>

<script>
  const hazardGroups = {
    "Safe": L.layerGroup(),
    "Acceptable": L.layerGroup(),
    "Somewhat hazardous": L.layerGroup(),
    "Hazardous": L.layerGroup(),
    "Very hazardous": L.layerGroup()
  };

  function toggleLayer(level) {
    const checkbox = document.getElementById('cb_' + level);
    if (checkbox.checked) {
      map.addLayer(hazardGroups[level]);
    } else {
      map.removeLayer(hazardGroups[level]);
    }
  }

  function createCheckboxControls() {
    const controlDiv = document.createElement('div');
    controlDiv.id = 'checkbox-controls';
    controlDiv.style = 'position: absolute; top: 10px; left: 10px; background: white; padding: 10px; z-index: 1000;';
    document.body.appendChild(controlDiv);

    for (const level in hazardGroups) {
      const label = document.createElement('label');
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.id = 'cb_' + level;
      checkbox.checked = true;
      checkbox.onchange = () => toggleLayer(level);
      label.appendChild(checkbox);
      label.append(" " + level);
      controlDiv.appendChild(label);
      controlDiv.appendChild(document.createElement("br"));
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    createCheckboxControls();
  });
</script>
</body>
</html>
