
<!DOCTYPE html>
<html>
<head>
    <title>Intersection Hazard Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <style>
        html, body, #map { height: 100%; margin: 0; padding: 0; }
        .legend {
            background: white;
            padding: 6px;
            border: 1px solid gray;
            line-height: 1.5em;
            font-size: 14px;
        }
        .legend i {
            width: 12px;
            height: 12px;
            float: left;
            margin-right: 6px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>

// Initialize the map
var map = L.map('map').setView([45.56548887051103, -73.62387221652051], 13);

// Base layer
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Color mapping
var hazardColors = {
    'Safe': 'blue',
    'Acceptable': 'lightblue',
    'Somewhat hazardous': 'orange',
    'Hazardous': 'red',
    'Very Hazardous': 'darkred'
};

// Create layer groups
var groups = {
    'Safe': L.layerGroup(),
    'Acceptable': L.layerGroup(),
    'Somewhat hazardous': L.layerGroup(),
    'Hazardous': L.layerGroup(),
    'Very Hazardous': L.layerGroup()
};

// Load the GeoJSON
fetch('intersection_model_all_levels.geojson')
    .then(res => res.json())
    .then(data => {
        let bounds = [];

        data.features.forEach(f => {
            var level = f.properties["Hazard lev"];
            var coords = f.geometry.coordinates;
            if (level && groups[level]) {
                var marker = L.circleMarker([coords[1], coords[0]], {
                    radius: 5,
                    fillColor: hazardColors[level],
                    color: hazardColors[level],
                    weight: 1,
                    fillOpacity: 0.8
                }).bindPopup("Hazard Level: " + level);
                marker.addTo(groups[level]);
                bounds.push([coords[1], coords[0]]);
            }
        });

        // Add groups to map
        for (const k in groups) {
            if (groups[k].getLayers().length > 0) {
                groups[k].addTo(map);
            }
        }

        // Fit to bounds if points exist
        if (bounds.length > 0) {
            map.fitBounds(bounds);
        }

        // Add checkboxes for all layers
        L.control.layers(null, groups).addTo(map);
    });

// Add legend
var legend = L.control({position: 'bottomright'});
legend.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'legend');
    var levels = ['Safe', 'Acceptable', 'Somewhat hazardous', 'Hazardous', 'Very Hazardous'];
    var colors = ['blue', 'lightblue', 'orange', 'red', 'darkred'];
    for (var i = 0; i < levels.length; i++) {
        div.innerHTML += '<i style="background:' + colors[i] + '"></i> ' + levels[i] + '<br>';
    }
    return div;
};
legend.addTo(map);
</script>
</body>
</html>
